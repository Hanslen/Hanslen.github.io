<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="Jiahe Chen&#39;s personal blog">
    

    <!--Author-->
    
        <meta name="author" content="Jiahe Chen (Hanslen)">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="Leap Motion brings gesture control to iPhone"/>
    

    <!--Open Graph Description-->
    
        <meta property="og:description" content="Jiahe Chen&#39;s personal blog" />
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="Jiahe Chen"/>

    <!--Type page-->
    
        <meta property="og:type" content="article" />
    

    <!--Page Cover-->
    

        <meta name="twitter:card" content="summary" />
    

    <!-- Title -->
    
    <title>Leap Motion brings gesture control to iPhone - Jiahe Chen</title>

    <!-- Bootstrap Core CSS -->
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet"/>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Google Analytics -->
    
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-101661435-1', 'auto');
        ga('send', 'pageview');

    </script>



    <!-- favicon -->
    
    <link rel="icon" href="img/icon.jpg">
    
	
</head>


<body>

    <!-- Menu -->
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Hanslen</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                
                    <li>
                        <a href="/">
                            
                                Home
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/tags">
                            
                                Tags
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/2015/12/18/Hanslen-says-Hi-to-you-XD/">
                            
                                About me
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="https://github.com/Hanslen">
                            
                                <i class="fa fa-github fa-stack-2x"></i>
                            
                        </a>
                    </li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

    <!-- Main Content -->
    <!-- Page Header -->
<!-- Set your background image for this header in your post front-matter: cover -->

<header class="intro-header" style="background-image: url('leapmotion.png')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Leap Motion brings gesture control to iPhone</h1>
                    
                    <span class="meta">
                        <!-- Date and Author -->
                        
                        
                            2017-01-06
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Tags and categories -->
           
                <div class="col-lg-4 col-lg-offset-2 col-md-5 col-md-offset-1 post-tags">
                    
                        


<a href="/tags/programming/">#programming</a> <a href="/tags/Unity-VR/">#Unity VR</a>


                    
                </div>
                <div class="col-lg-4 col-md-5 post-categories">
                    
                </div>
            

            <!-- Gallery -->
            

            <!-- Post Main Content -->
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <p>Recently, I am facing with a problem of how can I use my iPhone in Google Cardboard with Leap Motion? Unlike Oculus and other VR headsets, we cannot plug Leap Motion into iPhone. So the existing SDK of Unity built by LeapMotion cannot be used directly. In this tutorial, I am going to explain how to implement it.</p>
<p>The basic idea is I use Mac Laptop to support the Leap Motion and transfer the data through WIFI to iPhone. You need to know about socket communication in C# and some basic programming knowledge with Unity.</p>
<p>The first thing you need to do is to set up a C# server to receive Leap Motionâ€™s hand information on your Laptop. In the <a href="https://developer.leapmotion.com/documentation/v2/csharp/index.html" target="_blank" rel="external">Leap Motion official website Leap Motion C# SDK</a>, you can see what the kind of hand information we can collect. Keep this in mind <font style="color:red">The Leap Motion system employs a right-handed Cartesian coordinate system. The origin is centered at the top of the Leap Motion Controller. </font><br><img src="/2017/01/06/Leap-Motion-brings-gesture-control-to-iPhone/leap1.png" alt="leap1"></p>
<h1 id="Server-part"><a href="#Server-part" class="headerlink" title="Server part:"></a>Server part:</h1><p>So firstly, you need to try some examples with this C# SDK and then make some change to let these code work as a socket server. The way I used to do is to declare these variables at the top:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">private Object thisLock = new Object();</div><div class="line">TcpListener serverSocket = new TcpListener(8888);</div><div class="line">TcpClient clientSocket = default(TcpClient);</div></pre></td></tr></table></figure></p>
<p>And in the <code>public override void OnInit (Controller controller)</code> function, we start our server by:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">serverSocket.Start();</div><div class="line">clientSocket = serverSocket.AcceptTcpClient();</div></pre></td></tr></table></figure></p>
<p>Leap Motion has <code>public override void OnFrame(Controller controller)</code> which runs all the time to update the latest hand information. So I write the following code to send data to the client which is linked with this server:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">String textinput;</div><div class="line">textinput = clockwiseness;</div><div class="line">NetworkStream serverStream = clientSocket.GetStream ();</div><div class="line">byte[] outStream = System.Text.Encoding.ASCII.GetBytes (textinput + &quot;$&quot;);</div><div class="line">serverStream.Write (outStream, 0, outStream.Length);</div><div class="line">serverStream.Flush ();</div></pre></td></tr></table></figure></p>
<p>You can set any information as textinput, in this example, I am going to recognize the gestures clockwise and counterclockwise.</p>
<p>Now, you finished all the work for server.</p>
<h1 id="Client-part"><a href="#Client-part" class="headerlink" title="Client part:"></a>Client part:</h1><p>It is a unity project, so in the start function, we need to connect this project to the server:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">void Start () &#123;</div><div class="line">	getnewinfo = false;</div><div class="line">        testmove =GameObject.Find(&quot;testmove&quot;);</div><div class="line">	clientSocket.Connect(&quot;10.132.198.29&quot;, 8888);</div><div class="line">	oThread = new Thread (new ThreadStart (getInformation));</div><div class="line">	oThread.Start ();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>If we donâ€™t use thread here, you project will be easily stuck because it is always waiting for new messages from the server. GetInformation is the function which you use for receiving the data from the server:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">void getInformation()&#123;</div><div class="line">	while (true) &#123;</div><div class="line">	try &#123;</div><div class="line">		NetworkStream networkStream = clientSocket.GetStream ();</div><div class="line">		byte[] bytesFrom = new byte[10025];</div><div class="line">		networkStream.Read (bytesFrom, 0, (int)bytesFrom.Length);</div><div class="line">		string dataFromClient = System.Text.Encoding.ASCII.GetString (bytesFrom);</div><div class="line">		dataFromClient = dataFromClient.Substring (0, dataFromClient.IndexOf (&quot;$&quot;));</div><div class="line">		Debug.Log (&quot; &gt;&gt; Data from Server - &quot; + dataFromClient);</div><div class="line"></div><div class="line">		string serverResponse = &quot;Last Message from Server&quot; + dataFromClient;</div><div class="line">		getnewinfo = true;</div><div class="line">		tempMesg = dataFromClient;</div><div class="line">		Byte[] sendBytes = Encoding.ASCII.GetBytes (serverResponse);</div><div class="line">		networkStream.Write (sendBytes, 0, sendBytes.Length);</div><div class="line">		networkStream.Flush ();</div><div class="line">		Debug.Log (&quot; &gt;&gt; &quot; + serverResponse);</div><div class="line"></div><div class="line">	&#125; catch (Exception ex) &#123;</div><div class="line">		Debug.Log (&quot;Exception error:&quot; + ex.ToString ());</div><div class="line">		oThread.Abort ();</div><div class="line">		oThread.Join ();</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Because we can not update the UI interface in the thread in Unity, and we need to invoke functions on the main Thread. So I use the simple trick to update the interface. Set boolean variable getnewinfo, and in the Unityâ€™s default <code>void Update()</code>, write an if-statement to control the implementation of UI interface changing. ðŸ™‚</p>
<h1 id="Build-your-project-and-install-it-to-your-iPhone"><a href="#Build-your-project-and-install-it-to-your-iPhone" class="headerlink" title="Build your project and install it to your iPhone"></a>Build your project and install it to your iPhone</h1><p>Now, you can build your project and install it to iPhone. For better experience, I recommend using Vuforiaâ€™s AR Camera. With that, you can see the real world and your hand rather than the default sky in Unity. ðŸ™‚</p>
<h1 id="Further-implementation-and-questions"><a href="#Further-implementation-and-questions" class="headerlink" title="Further implementation and questions:"></a>Further implementation and questions:</h1><p>The detailed information of fingers are also collected by LeapMotion C# SDK, you can send it to your phone and create new features like holding some virtual things on your hand.</p>
<p>If you have any further questions, please leave a comment below. I am going to upload these sample code on Github after April. Thanks for reading.</p>


                
            </div>

            <!-- Comments -->
            
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    
    <hr />
    <h3>Comments:</h3>
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>



                </div>
            
        </div>
    </div>
</article>

    <!-- Footer -->
    <hr />

<!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    

                    
                        <li>
                            <a href="https://www.facebook.com/chen.hanslen" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    

                    
                        <li>
                            <a href="https://github.com/klugjo/hexo-theme-clean-blog" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    

                    
                        <li>
                            <a href="https://www.linkedin.com/in/jiahe-chen-b131a9100/" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    

                    

                    
                </ul>
                <p class="copyright text-muted">&copy; 2017 Jiahe Chen (Hanslen)<br>

                <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <span id="busuanzi_container_site_pv">Website's traffic: <span id="busuanzi_value_site_pv"></span> times</span>
            
                </p>
                <!--
                <p class="copyright text-muted">Original Theme <a target="_blank" href="http://startbootstrap.com/template-overviews/clean-blog/">Clean Blog</a> from <a href="http://startbootstrap.com/" target="_blank">Start Bootstrap</a></p>
                <p class="copyright text-muted">Adapted for <a target="_blank" href="https://hexo.io/">Hexo</a> by <a href="http://www.codeblocq.com/" target="_blank">Jonathan Klughertz</a></p>
                -->
            </div>
        </div>
    </div>
</footer>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-101661435-1', 'auto');
  ga('send', 'pageview');

</script>


    <!-- After footer scripts -->
    
<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Bootstrap -->
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Disqus Comments -->

<script type="text/javascript">
    var disqus_shortname = 'jiaheblog';

    (function(){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>


</body>

</html>